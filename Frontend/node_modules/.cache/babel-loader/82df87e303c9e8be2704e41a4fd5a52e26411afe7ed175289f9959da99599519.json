{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar dom_1 = require(\"./utils/dom\");\nvar date_1 = require(\"./utils/date\");\nvar locales_1 = require(\"./locales\");\n// all realtime timer\nvar TIMER_POOL = {};\n/**\n * clear a timer from pool\n * @param tid\n */\nvar clear = function (tid) {\n  clearTimeout(tid);\n  delete TIMER_POOL[tid];\n};\n// run with timer(setTimeout)\nfunction run(node, date, localeFunc, opts) {\n  // clear the node's exist timer\n  clear(dom_1.getTimerId(node));\n  var relativeDate = opts.relativeDate,\n    minInterval = opts.minInterval;\n  // get diff seconds\n  var diff = date_1.diffSec(date, relativeDate);\n  // render\n  node.innerText = date_1.formatDiff(diff, localeFunc);\n  var tid = setTimeout(function () {\n    run(node, date, localeFunc, opts);\n  }, Math.max(date_1.nextInterval(diff), minInterval || 1) * 1000, 0x7fffffff);\n  // there is no need to save node in object. Just save the key\n  TIMER_POOL[tid] = 0;\n  dom_1.setTimerId(node, tid);\n}\n// 取消一个 node 的实时渲染\nfunction cancel(node) {\n  // cancel one\n  if (node) clear(dom_1.getTimerId(node));\n  // cancel all\n  // @ts-ignore\n  else Object.keys(TIMER_POOL).forEach(clear);\n}\nexports.cancel = cancel;\n/**\n * render a dom realtime\n * @param nodes\n * @param locale\n * @param opts\n */\nfunction render(nodes, locale, opts) {\n  // by .length\n  var nodeList = 'length' in nodes ? nodes : [nodes];\n  nodeList.forEach(function (node) {\n    run(node, dom_1.getDateAttribute(node), locales_1.getLocale(locale), opts || {});\n  });\n  return nodeList;\n}\nexports.render = render;","map":{"version":3,"names":["dom_1","require","date_1","locales_1","TIMER_POOL","clear","tid","clearTimeout","run","node","date","localeFunc","opts","getTimerId","relativeDate","minInterval","diff","diffSec","innerText","formatDiff","setTimeout","Math","max","nextInterval","setTimerId","cancel","Object","keys","forEach","exports","render","nodes","locale","nodeList","getDateAttribute","getLocale"],"sources":["realtime.ts"],"sourcesContent":[null],"mappings":";;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AACA,IAAAE,SAAA,GAAAF,OAAA;AAGA;AACA,IAAMG,UAAU,GAAc,EAAE;AAEhC;;;;AAIA,IAAMC,KAAK,GAAG,SAAAA,CAACC,GAAW;EACxBC,YAAY,CAACD,GAAG,CAAC;EACjB,OAAOF,UAAU,CAACE,GAAG,CAAC;AACxB,CAAC;AAED;AACA,SAASE,GAAGA,CAACC,IAAiB,EAAEC,IAAY,EAAEC,UAAsB,EAAEC,IAAU;EAC9E;EACAP,KAAK,CAACL,KAAA,CAAAa,UAAU,CAACJ,IAAI,CAAC,CAAC;EAEf,IAAAK,YAAA,GAAAF,IAAA,CAAAE,YAAY;IAAEC,WAAA,GAAAH,IAAA,CAAAG,WAAW;EAEjC;EACA,IAAMC,IAAI,GAAGd,MAAA,CAAAe,OAAO,CAACP,IAAI,EAAEI,YAAY,CAAC;EACxC;EACAL,IAAI,CAACS,SAAS,GAAGhB,MAAA,CAAAiB,UAAU,CAACH,IAAI,EAAEL,UAAU,CAAC;EAE7C,IAAML,GAAG,GAAIc,UAAU,CACrB;IACEZ,GAAG,CAACC,IAAI,EAAEC,IAAI,EAAEC,UAAU,EAAEC,IAAI,CAAC;EACnC,CAAC,EACDS,IAAI,CAACC,GAAG,CAACpB,MAAA,CAAAqB,YAAY,CAACP,IAAI,CAAC,EAAED,WAAW,IAAI,CAAC,CAAC,GAAG,IAAI,EACrD,UAAU,CACW;EAEvB;EACAX,UAAU,CAACE,GAAG,CAAC,GAAG,CAAC;EACnBN,KAAA,CAAAwB,UAAU,CAACf,IAAI,EAAEH,GAAG,CAAC;AACvB;AAEA;AACA,SAAgBmB,MAAMA,CAAChB,IAAkB;EACvC;EACA,IAAIA,IAAI,EAAEJ,KAAK,CAACL,KAAA,CAAAa,UAAU,CAACJ,IAAI,CAAC,CAAC;EACjC;EACA;EAAA,KACKiB,MAAM,CAACC,IAAI,CAACvB,UAAU,CAAC,CAACwB,OAAO,CAACvB,KAAK,CAAC;AAC7C;AANAwB,OAAA,CAAAJ,MAAA,GAAAA,MAAA;AAQA;;;;;;AAMA,SAAgBK,MAAMA,CAACC,KAA6B,EAAEC,MAAe,EAAEpB,IAAW;EAChF;EACA,IAAMqB,QAAQ,GAAa,QAAQ,IAAIF,KAAK,GAAGA,KAAK,GAAK,CAACA,KAAK,CAA0B;EAEzFE,QAAQ,CAACL,OAAO,CAAC,UAACnB,IAAiB;IACjCD,GAAG,CAACC,IAAI,EAAET,KAAA,CAAAkC,gBAAgB,CAACzB,IAAI,CAAC,EAAEN,SAAA,CAAAgC,SAAS,CAACH,MAAM,CAAC,EAAEpB,IAAI,IAAI,EAAE,CAAC;EAClE,CAAC,CAAC;EAEF,OAAOqB,QAAQ;AACjB;AATAJ,OAAA,CAAAC,MAAA,GAAAA,MAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}